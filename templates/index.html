<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Infinite Book Architect</title>
  <link rel="stylesheet" href="/static/styles.css" />
</head>

<body>
  <div class="container">
      <header class="app-header">
          <div class="header-branding">
              <h1>Infinite Book Architect</h1>
              <div class="project-meta">
                  Language: <span id="project-language">...</span>
              </div>
              <div class="project-meta">
                  Project ID: <span id="project-id">...</span>
              </div>
          </div>

          <a href="/projects" class="secondary secondary-btn">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                   stroke-linecap="round" stroke-linejoin="round">
                  <line x1="19" y1="12" x2="5" y2="12"></line>
                  <polyline points="12 19 5 12 12 5"></polyline>
              </svg>
              Change project
          </a>
      </header>

    <!-- STEP 1: IDEA -->
    <details id="step-1" class="step" open>
      <summary>
        <span class="step-title">Step 1 ‚Äî Idea</span>
        <span id="step-1-status" class="step-status">In progress</span>
      </summary>

      <div class="step-body">
          <div class="input-group idea-row-1">
              <input type="text" id="genre" placeholder="Genre (e.g. Cyberpunk)" value="__IBA_DEFAULT__"/>
              <button id="btn-refine">Refine ‚ú®</button>
          </div>

          <div class="input-group idea-row-2">
              <textarea id="idea" rows="6">__IBA_DEFAULT__</textarea>
          </div>

        <div class="loader" id="loader-1">Brainstorming variations...</div>
        <div class="grid" id="variations-grid"></div>

        <div class="center-btn-area" id="confirm-idea-area" style="display:none;">
          <button id="btn-generate-plot">Generate Plot for Selected Story ‚û°Ô∏è</button>
        </div>
      </div>
    </details>

    <!-- STEP 2: PLOT -->
    <details id="step-2" class="step">
      <summary>
        <span class="step-title">Step 2 ‚Äî Plot</span>
        <span id="step-2-status" class="step-status">Locked</span>
      </summary>

      <div class="step-body">
        <div id="cover-box"
             style="display:none; margin-top:14px; padding:12px; border:1px solid #e2e8f0; border-radius:10px;">
            <div style="display:flex; align-items:center; justify-content:space-between; gap:12px; flex-wrap:wrap;">
                <div style="font-weight:700;">Cover image</div>
                <div id="cover-status" style="color:#64748b; font-size:0.9rem;">(idle)</div>
            </div>

            <div style="display:flex; gap:12px; margin-top:10px; flex-wrap:wrap; align-items:center;">
                <button id="btn-cover-generate" style="background:#0ea5e9;">Generate</button>
                <button id="btn-cover-regenerate" style="background:#0ea5e9; display:none;">Regenerate</button>
            </div>

            <div style="margin-top:12px;">
                <img id="cover-img" src="" alt="Cover"
                     style="display:none; width:100%; max-width:100%; height:auto; margin:12px auto 0; border-radius:10px; border:1px solid #0f172a;">
            </div>
        </div>

        <h2>Chapter Outline</h2>
        <div class="loader" id="loader-2">Designing story arc...</div>
        <div id="plot-content" class="plot-container" style="display:none;"></div>

        <div class="center-btn-area">
          <button id="btn-generate-chars" disabled>Create Cast of Characters üë•</button>
        </div>
      </div>
    </details>

    <!-- STEP 3: CHARACTERS -->
    <details id="step-3" class="step">
      <summary>
        <span class="step-title">Step 3 ‚Äî Characters</span>
        <span id="step-3-status" class="step-status">Locked</span>
      </summary>

      <div class="step-body">
        <h2>Characters</h2>
        <div
          id="char-img-box"
          style="display:none; margin-top:12px; padding:12px; border:1px solid #e2e8f0; border-radius:10px;"
        >
          <div style="display:flex; align-items:center; justify-content:space-between; gap:12px; flex-wrap:wrap;">
            <div style="font-weight:700;">Character images</div>
            <button id="btn-char-recreate-all" style="background:#0ea5e9;">Recreate all</button>
          </div>

          <div id="char-img-status" style="margin-top:8px; color:#64748b; font-size:0.9rem;">
            idle
          </div>
        </div>
        <div class="loader" id="loader-3">Casting roles...</div>

        <div id="chars-container" style="display:none;">
          <h3>Protagonists</h3>
          <div class="grid" id="protagonists-grid"></div>

          <h3 class="header-antagonist">Antagonists</h3>
          <div class="grid" id="antagonists-grid"></div>

          <h3 class="header-supporting">Supporting Cast</h3>
          <div class="grid" id="supporting-grid"></div>
        </div>
      </div>
    </details>

    <!-- STEP 4: CHAPTER BEATS -->
    <details id="step-4" class="step">
      <summary>
        <span class="step-title">Step 4 ‚Äî Chapter Beats</span>
        <span id="step-4-status" class="step-status">Locked</span>
      </summary>

      <div class="step-body">
        <h2>Chapter Blueprint</h2>
        <div class="loader" id="loader-4">Breaking down the chapter...</div>

        <div id="beats-container" style="display:none;">
          <h3 id="current-chapter-title-display"></h3>
          <div class="center-btn-area" style="display:flex; gap:10px; justify-content:center; flex-wrap:wrap;">
            <button id="btn-prev-chapter-step4" disabled>‚óÄ Prev Chapter</button>
            <button id="btn-next-chapter-step4" disabled>Next Chapter ‚ñ∂</button>
          </div>
          <div style="display:flex; gap:10px; justify-content:center; flex-wrap:wrap; margin-top:10px;">
            <button id="btn-plan-chapter" disabled>Generate plan</button>
            <button id="btn-generate-scenes" disabled style="background:#8b5cf6;">Generate Illustrations üé®</button>
          </div>

          <div id="step-4-plan-hint" style="text-align:center; color:#64748b; margin-top:8px;">
            No plan loaded.
          </div>
          <div class="beats-list" id="beats-list"></div>

          <div class="center-btn-area">
            <button id="btn-write-it" style="background:#6366f1; font-size:1.2rem;" disabled>
              Write It! ‚úçÔ∏è
            </button>
          </div>
        </div>
      </div>
    </details>

    <!-- STEP 5: WRITE (PROSE) -->
    <details id="step-5" class="step">
      <summary>
        <span class="step-title">Step 5 ‚Äî Write</span>
        <span id="step-5-status" class="step-status">Locked</span>
      </summary>

      <div class="step-body">
        <h2>Chapter Text</h2>
        <h3 id="step-5-chapter-title" style="margin-top:-6px;"></h3>

        <div class="center-btn-area" style="display:flex; gap:10px; justify-content:center; flex-wrap:wrap;">
          <button id="btn-prev-chapter" disabled>‚óÄ Prev Chapter</button>
          <button id="btn-next-chapter" disabled>Next Chapter ‚ñ∂</button>
        </div>

          <div class="center-btn-area"
               style="margin-bottom:12px; display:flex; gap:10px; justify-content:center; flex-wrap:wrap;">
              <button id="btn-write-next" style="background:#6366f1; font-size:1.1rem;" disabled>
                  Write Next Beat ‚ñ∂
              </button>

              <button id="btn-generate-all" style="background:#0ea5e9; font-size:1.1rem;" disabled>
                  Generate All ‚è©
              </button>

              <button id="btn-clear-all" style="background:#ef4444; font-size:1.1rem;" disabled>
                  Clear All üóë
              </button>
          </div>

        <div id="write-beats-list" class="beats-list"></div>

        <pre id="generated-text"
             style="display:none; white-space:pre-wrap; margin-top:16px; padding:12px; background:#0b1220; color:#e2e8f0; border-radius:8px;"></pre>
      </div>
    </details>
  </div>

  <!-- Monitoring Widget, remove hidden="true" to show -->
  <div id="monitor-widget" hidden="true">
    <div class="monitor-title">SYSTEM STATUS</div>

      <div class="mon-row">
          <span class="mon-label">Providers LLM:</span>
          <span id="llm-providers" class="mon-val">...</span>
      </div>

      <div class="mon-row">
          <span class="mon-label">Providers TTS:</span>
          <span id="tts-providers" class="mon-val">...</span>
      </div>

    <div class="mon-row">
      <span class="mon-label">Ollama:</span>
      <span><span id="ollama-dot" class="status-dot"></span><span id="ollama-status">Checking...</span></span>
    </div>

    <div class="mon-row">
      <span class="mon-label">GPU:</span>
      <span id="gpu-name" class="mon-val">...</span>
    </div>

    <div class="mon-row">
      <span class="mon-label">Load CPU:</span>
      <span id="cpu-load" class="mon-val">0%</span>
    </div>

    <div class="mon-row">
      <span class="mon-label">Load GPU:</span>
      <span id="gpu-load" class="mon-val">0%</span>
    </div>

    <div class="mon-vram">
      <div class="mon-row" style="margin-bottom:2px;">
        <span class="mon-label">VRAM:</span>
        <span id="vram-text" class="mon-val">0 / 0 MB</span>
      </div>
      <div class="progress-bg">
        <div id="vram-bar" class="progress-fill"></div>
      </div>
    </div>

    <div class="mon-vram">
      <div class="mon-row" style="margin-bottom:2px;">
        <span class="mon-label">RAM:</span>
        <span id="ram-text" class="mon-val">0 / 0 GB</span>
      </div>
      <div class="progress-bg">
        <div id="ram-bar" class="progress-fill"></div>
      </div>
    </div>
  </div>

  <div id="image-modal" onclick="closeImageModal()">
    <span class="close">&times;</span>
    <img id="modal-img-content" src="" alt="Full Screen">
  </div>

  <script src="/static/utils.js"></script>
  <script src="/static/monitor.js"></script>
  <script src="/static/app.js"></script>
</body>
</html>
